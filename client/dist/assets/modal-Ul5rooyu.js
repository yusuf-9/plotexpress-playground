import{r,M as p,ap as C,aq as x,ar as k,av as y,aw as v,j as e,J as E,B as b,ax as F}from"./index-6MAVHgSl.js";import{c as U,d as D,D as R,a as I}from"./dialog-_VDH8kWv.js";const _=100*1024*1024;function A(){const[m,l]=r.useState("checking-data-size"),[n,s]=r.useState(""),[o,i]=r.useState({percentageCompletion:0,error:null}),c=p(a=>a.files),u=p(a=>a.workspace.name),h=p(a=>a.charts),f=r.useCallback(()=>{const a=JSON.stringify(c),t=new TextEncoder().encode(a).length;if(t>_)throw new Error(`Total file size (${(t/(1024*1024)).toFixed(2)}MB) exceeds the maximum limit of 100MB`)},[c]),g=r.useCallback(async()=>{const a=await C.get("/generate-upload-urls");return[a.data.data.dataFileUploadURI,a.data.data.configFileUploadURI,a.data.data.sharedWorkspaceId]},[]),w=r.useCallback(async a=>{try{await x(async()=>await k.put(a,JSON.stringify({[y]:c}),{method:"put"}))}catch(t){throw new Error("Failed to upload file: "+(t instanceof Error?t.message:"Something went wrong"))}},[c]),j=r.useCallback(async a=>{try{await x(async()=>await k.put(a,JSON.stringify({[y]:{workspaceName:u,charts:h}}),{method:"PUT"}))}catch(t){throw new Error("Failed to upload workspace config: "+(t instanceof Error?t.message:"Something went wrong"))}},[h,u]),S=r.useCallback(async()=>{try{l("checking-data-size"),f(),i(d=>({...d,percentageCompletion:30})),l("generating-signed-urls");const[a,t,N]=await x(g);i(d=>({...d,percentageCompletion:50})),l("uploading-files"),await Promise.all([w(a),j(t)]),i(d=>({...d,percentageCompletion:100})),s(`${window.location.origin}?${v}=${N}`),setTimeout(()=>{l("completed")},500)}catch(a){console.error(a),i(t=>({...t,error:a instanceof Error?a.message:"Failed to create share link. Please try again later"}))}},[f,g,w,j]);return r.useEffect(()=>{S()},[S]),{uploadStep:m,shareLink:n,uploadState:o}}function B(m){const{onClose:l}=m,{shareLink:n,uploadState:s,uploadStep:o}=A(),i=r.useMemo(()=>{const c=e.jsx("h2",{className:"text-2xl font-bold text-center text-foreground mb-8",children:"Your share link will be ready shortly"});switch(!0){case!!s.error:return e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx("h3",{className:"text-2xl font-bold text-center text-destructive",children:"Failed to generate share link!"}),e.jsx("p",{className:"text-center text-destructive-foreground mb-2 text-sm",children:s.error})]});case!!(o==="completed"&&n.length):return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-foreground mb-6",children:"Your share link is ready!"}),e.jsx("div",{className:"w-full max-w-md flex flex-col items-center",children:e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(E,{className:"flex-grow",value:n,readOnly:!0}),e.jsx(b,{variant:"outline",onClick:()=>{navigator.clipboard.writeText(n),F.success("Share link copied to clipboard")},children:"Copy"})]})})]});default:return e.jsxs(e.Fragment,{children:[c,e.jsxs("div",{className:"w-full max-w-md flex flex-col items-center",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"})}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-lg font-medium mb-2",children:[s.percentageCompletion,"%"]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-4",children:e.jsx("div",{className:"bg-primary h-3 rounded-full transition-all",style:{width:`${s.percentageCompletion}%`}})})]}),e.jsxs("div",{className:"text-center text-muted-foreground mb-2 text-sm",children:[o.split("-").join(" "),"..."]})]})]})}},[n,s.error,s.percentageCompletion,o]);return e.jsx(U,{open:!0,onOpenChange:()=>{o==="completed"&&l()},children:e.jsxs(D,{className:"!w-[80vw] !max-w-[1000px] h-[80vh] max-h-[800px] p-0 flex flex-col",children:[e.jsx(R,{className:"px-6 py-4",children:e.jsx(I,{className:"text-foreground",children:"Share Workspace"})}),e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center px-8",children:[i," "]}),e.jsx("div",{className:"px-8 py-4 border-t border-border flex",children:e.jsx(b,{variant:o==="completed"?"default":"destructive",onClick:l,className:"w-full",children:o==="completed"?"Done":"Cancel"})})]})})}export{B as default};
